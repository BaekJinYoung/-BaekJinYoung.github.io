---
title: PHP/Laravel 데이터베이스 마이그레이션
author: Baek JinYoung
date: 2024-10-30
category: Jekyll
layout: post
---

PHP/Laravel 데이터베이스 테이블 생성 마이그레이션
-

마이그레이션 파일은 테이블 생성, 수정 등의 작업을 위한 파일이다.    

라라벨은 테이블 이름을 복수형으로 사용하는 것을 권장한다.    
라라벨의 Eloquent ORM이 기본적으로 클래스 이름의 복수형을 테이블 이름으로 자동 매핑하기 때문이다.    

예를 들어, Member라는 모델을 만들면 Eloquent는 기본적으로 members라는 테이블과 연결한다.    
이때 만약 테이블 이름이 member라면 모델과 테이블을 자동으로 매핑하지 못해 문제가 생길 수 있다.    

터미널에 다음 명령어를 입력해 마이그레이션 파일을 생성한다.    

### 1. 마이그레이션 파일 생성

```bash
php artisan make:migration create_[테이블 이름]_table --create=[테이블 이름]

php artisan make:migration create_members_table --create=members
```

__php artisan__    
Laravel의 CLI(명령줄 인터페이스) 도구로, 다양한 Artisan 명령어를 실행하는 데 사용한다.    

__make:migration__    
마이그레이션 파일을 생성하는 Atisan 명령어이다.    
마이그레이션은 데이터베이스 스키마의 버전을 관리하는 도구이다.    
마이그레이션을 사용하면 데이터베이스의 테이블을 생성하거나 수정하고, 데이터베이스의 변경 사항에 대한 버전을 관리할 수 있다.    

__create_[테이블 이름]_table__    
생성할 마이그레이션 파일의 이름이다.    
라라벨은 이 이름을 바탕으로 마이그레이션 파일의 역할을 이해한다.    
예를 들어 create_members_table이라는 이름은 'members'라는 테이블을 생성하는 마이그레이션이라는 의미이다.    

__--create=[테이블 이름]__    
이 옵션은 라라벨에 이 마이그레이션이 새로운 테이블을 생성하는 것임을 알린다.    
이 옵션을 사용하면 라라벨은 마이그레이션 파일 내에 up 메서드와 down 메서드에서 사용할 기본 코드를 자동으로 생성한다.    

이 명령어를 입력하면 다음과 같은 파일이 생성된다.    

```php
// database/migrations/2024_09_24_065403_create_members_table.php

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('members', function (Blueprint $table) {
            $table->id();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('members');
    }
};
```

__up()__    
데이터베이스에 테이블을 생성하는 코드를 정의한다.    
이 메서드가 실행되면 'members' 테이블이 생성된다.    

__Schema__    
라라벨의 Schema 클래스는 데이터베이스 구조를 정의하고 조작하기 위한 메서드를 제공한다.    
라라벨의 데이터베이스 마이그레이션 시스템의 핵심 요소이다.    

__create()__    
새로운 데이터베이스를 생성한다.    
첫 번째 인자 'members'는 생성할 테이블의 이름이다.    
두 번재 인자는 롤백 함수로, 테이블의 구조를 정의하는 Blueprint 객체를 받는다.    
Blueprint는 Laravel의 Schema 클래스에 의해 생성되며, 데이터베이스 테이블의 구조를 정의하는 데 사용된다.    

__$table__    
마이그레이션에서 사용되는 Blueprint 객체를 나타낸다.    

__->id()__    
기본 키(primary key)로 사용할 id 칼럼을 생성한다.    
id 칼럼은 자동 증가(integer type)하며, 각 레코드에 고유한 식별자를 제공한다.    

__timestamps()__    
created_at과 updated_at이라는 두 개의 타임스탬프(timestamp) 칼럼을 자동으로 생성한다.    
created_at은 레코드가 생성된 시간을, updated_at은 마지막으로 수정된 시간을 기록한다.    

__down()__    
마이그레이션을 롤백할 때 호출되는 메서드이다.    
이 경우 'members' 테이블을 삭제하는 코드를 포함한다.    

__dropIfExists__    
주어진 테이블 이름의 테이블이 존재할 경우에만 삭제한다.    
즉, 지정한 테이블이 존재하지 않으면 오류를 발생시키지 않고 그냥 넘어간다.    
삭제하고자 하는 테이블의 이름을 인자로 받는다.    


다음과 같이 해당 테이블에 필요한 칼럼을 create 메서드 이하에 추가한다.    

```php
// database/migrations/2024_09_24_065403_create_members_table.php

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('members', function (Blueprint $table) {
            $table->id();
            $table->string('name'); // 이름
            $table->string('department'); // 분야
            $table->string('rank'); // 직급
            $table->string('image')->nullable(); // 이미지
            $table->string('image_name')->nullable(); // 이미지 파일명
            $table->timestamps();
            $table->softDeletes(); //삭제
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('members');
    }
};
```


__->string()__    
string('image')는 'image'라는 이름의 문자열 컬럼을 생성하겠다는 의미이다.    
string 메서드는 VARCHAR 타입의 컬럼을 생성하며, 기본적으로 길이는 255자로 설정된다.     
이 컬럼은 주로 텍스트 데이터를 저장하는 데 사용된다.    

__->nullable()__    
해당 칼럼이 NULL 값을 가질 수 있음을 정의한다.    
즉, 이 칼럼은 필수가 아니며 데이터가 없는 경우 NULL로 설정된다.    
데이터베이스에 데이터를 삽입할 때 컬럼에 대한 값이 제공되지 않더라도 오류가 발생하지 않으며, 해당 값은 NULL로 저장된다.    

->nullable()처럼 마이그레이션에서 칼럼을 정의할 때 추가 옵션을 설정하는 메서드를 __Column Modifiers, 컬럼 수정자__ 라고 한다.    


### 2. 마이그레이션 파일 실행

마이그레이션 파일을 완성했으면 터미널에 다음 명령어를 입력해 마이그레이션을 실행한다.    

```bash
php artisan migrate
```

이 명령어를 입력하면 Laravel 프로젝트의 database/migrations 디렉토리에 있는 모든 마이그레이션 파일이 실행된다.    

특정 마이그레이션만 실행하고 싶다면 --path 옵션을 사용하여 경로를 지정할 수 있다.    

```bash
php artisan migrate --path=[마이그레이션 파일 경로]

php artisan migrate --path=database/migrations/2024_09_24_065403_create_members_table.php
```